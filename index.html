<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lịch trình đi chơi của chúng ta 💕</title>
  <link rel="icon" type="image/png" href="https://cdn-icons-png.flaticon.com/512/833/833472.png">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;600;700&display=swap');

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      /* Remove mobile tap highlights globally */
      -webkit-tap-highlight-color: transparent;
      -webkit-touch-callout: none;
    }

    /* Additional mobile tap highlight removal */
    button, input, textarea, select, a, div {
      -webkit-tap-highlight-color: transparent;
      -webkit-touch-callout: none;
    }

    body {
      font-family: 'Nunito', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
      min-height: 100vh;
      padding: 20px;
      position: relative;
      overflow-x: hidden;
    }

    /* Animated background particles */
    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image:
        radial-gradient(circle at 20% 50%, rgba(255, 255, 255, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 80% 80%, rgba(255, 255, 255, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 40% 20%, rgba(255, 255, 255, 0.05) 0%, transparent 50%);
      animation: particleMove 20s ease-in-out infinite;
      pointer-events: none;
      z-index: 0;
    }

    @keyframes particleMove {
      0%, 100% { transform: translate(0, 0); }
      33% { transform: translate(30px, -30px); }
      66% { transform: translate(-20px, 20px); }
    }

    .container {
      max-width: 600px;
      margin: 0 auto;
      background: rgba(255, 255, 255, 0.98);
      border-radius: 30px;
      box-shadow: 0 25px 60px rgba(102, 126, 234, 0.4);
      overflow: hidden;
      backdrop-filter: blur(15px);
      position: relative;
      z-index: 1;
      animation: slideInUp 0.8s ease-out;
    }

    @keyframes slideInUp {
      from {
        opacity: 0;
        transform: translateY(50px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      padding: 35px 20px;
      text-align: center;
      color: white;
      position: relative;
      overflow: hidden;
    }

    .header::after {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
      animation: headerGlow 8s ease-in-out infinite;
    }

    @keyframes headerGlow {
      0%, 100% { transform: translate(0, 0); }
      50% { transform: translate(10%, 10%); }
    }

    .header::before {
      content: '🌸✨🎬✨🌸';
      position: absolute;
      top: 5px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 20px;
      opacity: 0.8;
      z-index: 2;
    }

    .header h1 {
      font-size: 28px;
      font-weight: 700;
      margin-bottom: 10px;
      text-shadow: 0 3px 10px rgba(0,0,0,0.2);
      position: relative;
      z-index: 2;
    }

    .header p {
      font-size: 16px;
      opacity: 0.95;
      position: relative;
      z-index: 2;
    }

    .content {
      padding: 30px;
    }

    .schedule-item {
      background: linear-gradient(135deg, #ffffff, #f3f4ff);
      border: 2px solid #c7d2fe;
      border-radius: 18px;
      padding: 22px;
      margin-bottom: 20px;
      transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      position: relative;
      overflow: hidden;
    }

    .schedule-item::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(102, 126, 234, 0.1), transparent);
      transition: left 0.6s ease;
    }

    .schedule-item:hover::before {
      left: 100%;
    }

    .schedule-item:hover {
      transform: translateY(-8px) scale(1.02);
      box-shadow: 0 15px 40px rgba(102, 126, 234, 0.3);
      border-color: #818cf8;
    }

    .schedule-item h3 {
      color: #5b21b6;
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
      position: relative;
      z-index: 1;
    }

    .movie-options {
      display: grid;
      gap: 15px;
      margin: 20px 0;
    }

    .movie-card {
      background: linear-gradient(135deg, #ffffff, #ede9fe);
      border: 2px solid #c7d2fe;
      border-radius: 15px;
      padding: 18px;
      cursor: pointer;
      transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      position: relative;
      overflow: hidden;
    }

    .movie-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(102, 126, 234, 0.2), transparent);
      transition: left 0.6s ease;
    }

    .movie-card:hover::before {
      left: 100%;
    }

    .movie-card:hover {
      transform: scale(1.05) translateY(-3px);
      border-color: #818cf8;
      box-shadow: 0 12px 30px rgba(102, 126, 234, 0.35);
    }

    .movie-card:active {
      transform: scale(0.98);
      transition: all 0.1s ease;
    }

    .movie-card.selected {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border-color: #5b21b6;
      transform: scale(1.03);
      animation: selectedPulse 2s ease-in-out infinite;
    }

    @keyframes selectedPulse {
      0%, 100% { box-shadow: 0 12px 30px rgba(102, 126, 234, 0.4); }
      50% { box-shadow: 0 15px 40px rgba(102, 126, 234, 0.6); }
    }

    .movie-title {
      font-weight: 600;
      font-size: 16px;
      margin-bottom: 8px;
    }

    .movie-info {
      font-size: 14px;
      opacity: 0.8;
      line-height: 1.4;
    }

    .movie-card.selected .movie-info {
      opacity: 0.9;
    }

    .submit-btn {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      border: none;
      padding: 16px 35px;
      border-radius: 30px;
      font-size: 17px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      width: 100%;
      margin-top: 20px;
      box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
      position: relative;
      overflow: hidden;
    }

    .submit-btn::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.3);
      transform: translate(-50%, -50%);
      transition: width 0.6s ease, height 0.6s ease;
    }

    .submit-btn:hover::before {
      width: 300px;
      height: 300px;
    }

    .submit-btn:hover {
      transform: translateY(-4px) scale(1.02);
      box-shadow: 0 12px 35px rgba(102, 126, 234, 0.5);
    }

    .submit-btn:active {
      transform: translateY(-1px) scale(0.98);
      transition: all 0.1s ease;
    }

    .submit-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.2);
    }

    .submit-btn:disabled:hover {
      transform: none;
    }

    .cute-emoji {
      display: inline-block;
      animation: bounce 2s infinite;
    }

    @keyframes bounce {
      0%, 20%, 50%, 80%, 100% {
        transform: translateY(0);
      }
      40% {
        transform: translateY(-5px);
      }
      60% {
        transform: translateY(-3px);
      }
    }

    .success-message {
      background: linear-gradient(135deg, #fbcfe8, #e9d5ff);
      color: #86198f;
      padding: 20px;
      border-radius: 15px;
      text-align: center;
      font-weight: 600;
      margin-top: 20px;
      display: none;
      border: 2px solid #ec4899;
    }

    .nicknames {
      font-size: 14px;
      opacity: 0.8;
      margin-top: 10px;
      font-style: italic;
    }

    .music-controls {
      position: fixed;
      top: 20px;
      right: 20px;
      background: rgba(255, 255, 255, 0.9);
      border: 2px solid #fbcfe8;
      border-radius: 50px;
      padding: 10px 15px;
      display: flex;
      align-items: center;
      gap: 10px;
      backdrop-filter: blur(10px);
      box-shadow: 0 5px 15px rgba(190, 24, 93, 0.2);
      z-index: 1000;
      cursor: grab;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
      user-select: none;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
    }

    .music-controls:active {
      cursor: grabbing;
    }

    .music-controls.dragging {
      cursor: grabbing;
      transform: scale(1.05);
      box-shadow: 0 10px 30px rgba(190, 24, 93, 0.4);
      background: rgba(255, 255, 255, 0.95);
      transition: none;
    }

    .music-btn {
      background: linear-gradient(135deg, #a855f7, #ec4899);
      color: white;
      border: none;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 16px;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      /* Remove mobile tap highlights */
      -webkit-tap-highlight-color: transparent;
      -webkit-touch-callout: none;
      -webkit-user-select: none;
      -khtml-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
      outline: none;
    }

    .music-btn:hover {
      transform: scale(1.1);
      box-shadow: 0 5px 15px rgba(190, 24, 93, 0.3);
    }

    .music-btn:focus {
      outline: none;
    }

    .music-btn:active {
      outline: none;
      -webkit-tap-highlight-color: transparent;
    }

    .music-info {
      font-size: 12px;
      color: #a21caf;
      font-weight: 600;
    }

    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }

    .playing {
      animation: pulse 2s infinite;
    }

    /* Runaway button styles */
    .button-container {
      display: flex;
      gap: 15px;
      margin-top: 25px;
      justify-content: center;
      flex-wrap: wrap;
    }

    .reject-btn {
      background: linear-gradient(135deg, #ef4444, #dc2626);
      color: white;
      border: none;
      padding: 14px 28px;
      border-radius: 30px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 6px 18px rgba(239, 68, 68, 0.4);
      /* Initially static, will become fixed when escaping */
    }

    .reject-btn:hover {
      transform: scale(0.95);
      box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
    }

    .reject-btn.shrinking {
      animation: shrinkAway 1.5s ease-out forwards;
    }

    @keyframes shrinkAway {
      0% {
        opacity: 1;
        transform: scale(1);
      }
      70% {
        opacity: 0.5;
        transform: scale(0.3);
      }
      100% {
        opacity: 0;
        transform: scale(0);
        display: none;
      }
    }

    .accept-btn {
      background: linear-gradient(135deg, #10b981, #059669);
      color: white;
      border: none;
      padding: 14px 28px;
      border-radius: 30px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      box-shadow: 0 6px 18px rgba(16, 185, 129, 0.4);
      position: relative;
      overflow: hidden;
    }

    .accept-btn::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.3);
      transform: translate(-50%, -50%);
      transition: width 0.6s ease, height 0.6s ease;
    }

    .accept-btn:hover::before {
      width: 300px;
      height: 300px;
    }

    .accept-btn:hover {
      transform: translateY(-4px) scale(1.08);
      box-shadow: 0 10px 30px rgba(16, 185, 129, 0.5);
    }

    .accept-btn:active {
      transform: scale(0.95);
    }

    /* Interactive quiz section */
    .quiz-section {
      background: linear-gradient(135deg, #fef3c7, #fde68a);
      border: 2px solid #fbbf24;
      border-radius: 18px;
      padding: 25px;
      margin-top: 25px;
      position: relative;
      overflow: hidden;
    }

    .quiz-section::before {
      content: '';
      position: absolute;
      top: -50%;
      right: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(255, 255, 255, 0.2) 0%, transparent 70%);
      animation: quizGlow 10s ease-in-out infinite;
    }

    @keyframes quizGlow {
      0%, 100% { transform: translate(0, 0) rotate(0deg); }
      50% { transform: translate(-10%, -10%) rotate(180deg); }
    }

    .quiz-section h3 {
      color: #92400e;
      font-size: 19px;
      font-weight: 700;
      margin-bottom: 18px;
      position: relative;
      z-index: 1;
    }

    .quiz-option {
      background: white;
      border: 2px solid #fbbf24;
      border-radius: 12px;
      padding: 12px 18px;
      margin: 10px 0;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      position: relative;
      z-index: 1;
    }

    .quiz-option:hover {
      transform: translateX(10px) scale(1.02);
      background: #fffbeb;
      border-color: #f59e0b;
      box-shadow: 0 5px 15px rgba(245, 158, 11, 0.3);
    }

    .quiz-option.correct {
      background: linear-gradient(135deg, #86efac, #4ade80);
      border-color: #16a34a;
      color: #14532d;
      font-weight: 600;
      animation: correctAnswer 0.6s ease;
    }

    .quiz-option.wrong {
      background: linear-gradient(135deg, #fca5a5, #f87171);
      border-color: #dc2626;
      color: #7f1d1d;
      animation: shake 0.5s ease;
    }

    @keyframes correctAnswer {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }

    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-10px); }
      75% { transform: translateX(10px); }
    }

    /* Modern Message Box */
    .message-box {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0);
      background: white;
      border-radius: 20px;
      padding: 30px 40px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      z-index: 10000;
      max-width: 400px;
      text-align: center;
      opacity: 0;
      transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }

    .message-box.show {
      opacity: 1;
      transform: translate(-50%, -50%) scale(1);
    }

    .message-box-content {
      font-size: 18px;
      color: #333;
      margin-bottom: 20px;
      line-height: 1.6;
    }

    .message-box-button {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      border: none;
      padding: 12px 30px;
      border-radius: 25px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
    }

    .message-box-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(102, 126, 234, 0.5);
    }

    .message-box-button:active {
      transform: translateY(0);
    }

    .message-box-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 9999;
      opacity: 0;
      transition: opacity 0.3s ease;
      pointer-events: none;
    }

    .message-box-overlay.show {
      opacity: 1;
      pointer-events: auto;
    }

    /* Notification Box */
    .notification-box {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0.7);
      background: white;
      padding: 30px 40px;
      border-radius: 20px;
      box-shadow: 0 15px 40px rgba(102, 126, 234, 0.4);
      z-index: 10000;
      opacity: 0;
      pointer-events: none;
      transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      max-width: 90%;
      text-align: center;
    }

    .notification-box.show {
      opacity: 1;
      transform: translate(-50%, -50%) scale(1);
      pointer-events: auto;
    }

    .notification-box-content {
      font-size: 18px;
      color: #333;
      margin-bottom: 20px;
      line-height: 1.6;
    }

    .notification-box-btn {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 12px 30px;
      border-radius: 25px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
    }

    .notification-box-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
    }

    .notification-box-btn:active {
      transform: translateY(0);
    }

    .notification-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 9999;
      opacity: 0;
      transition: opacity 0.3s ease;
      pointer-events: none;
    }

    .notification-overlay.show {
      opacity: 1;
      pointer-events: auto;
    }

    /* Shake animation for reject button */
    @keyframes shake {
      0%, 100% { transform: translateX(0) scale(0.3); }
      10%, 30%, 50%, 70%, 90% { transform: translateX(-10px) scale(0.3); }
      20%, 40%, 60%, 80% { transform: translateX(10px) scale(0.3); }
    }
  </style>
</head>
<body>
    <!-- Music Controls -->
    <div class="music-controls">
        <button class="music-btn" id="musicBtn">🎵</button>
        <div class="music-info">
            <div>Vườn Mây Vừa Hay</div>
            <div style="font-size: 10px; opacity: 0.7;">Click để phát nhạc</div>
        </div>
    </div>
    
    <!-- Audio with local file -->
    <audio id="backgroundMusic" loop>
        <source src="https://res.cloudinary.com/daartoyul/video/upload/v1759043721/vuon_may_vua_hay_ktd9jb.mp3" type="audio/mpeg">
    </audio>

    <div class="container">
        <div class="header">
            <h1>Lịch trình đi chơi của chúng ta <span class="cute-emoji">💕</span></h1>
            <p>Hãy chọn phim em muốn xem nhé!</p>
            <div class="nicknames">
                Dành cho dân chơi aka em bé aka em nhỏ aka kf của toi <span class="cute-emoji">🐿️</span>
            </div>
        </div>
        
        <div class="content">
            <div class="schedule-item">
                <h3><span class="cute-emoji">🏠</span> 18h30: Có mặt tại nhà em pé</h3>
                <p style="color: #666; margin-left: 35px;">Đúng giờ nhé, đừng để em pé đợi! <span class="cute-emoji">⏰</span></p>
            </div>
            
            <div class="schedule-item">
                <h3><span class="cute-emoji">🎬</span> Đi xem phim</h3>
                <p style="color: #666; margin-bottom: 15px;">Chọn phim em muốn xem nha:</p>
                
                <div class="movie-options">
                    <div class="movie-card" data-movie="Đồi Hành Xác">
                        <div class="movie-title">🧟 Phim "Đồi Hành Xác"</div>
                        <div class="movie-info">📍 CGV Thảo Điền Pearl<br>⏰ 18:05 chiếu</div>
                    </div>
                    
                    <div class="movie-card" data-movie="EXIT 8: GA TÀU VÔ TẬN">
                        <div class="movie-title">🚂 Phim "EXIT 8: GA TÀU VÔ TẬN"</div>
                        <div class="movie-info">📍 CGV Menas Mall (CGV CT Plaza)<br>⏰ 18:00 chiếu</div>
                    </div>
                    
                    <div class="movie-card" data-movie="The Conjuring">
                        <div class="movie-title">👻 Phim "The Conjuring"</div>
                        <div class="movie-info">📍 CGV Gigamall Thủ Đức<br>⏰ 17:40 chiếu<br>💡 17h15 có mặt tại nhà em pé</div>
                    </div>
                    
                    <div class="movie-card" data-movie="Làm Giàu Với Ma">
                        <div class="movie-title">💰 Phim "Làm Giàu Với Ma"</div>
                        <div class="movie-info">📍 CGV Pandora City<br>⏰ 17:50 chiếu<br>💡 17h15 có mặt tại nhà em pé</div>
                    </div>
                </div>
            </div>
            
            <div class="schedule-item">
                <h3><span class="cute-emoji">🍗</span> Đến Tiệm Gà Bok Bok mua gà</h3>
                <p style="color: #666; margin-left: 35px;">Ăn gà giòn ngon sau phim! <span class="cute-emoji">😋</span></p>
            </div>
            
            <div class="schedule-item">
                <h3><span class="cute-emoji">🌸</span> Đi dạo ở Công Viên Sáng Tạo</h3>
                <p style="color: #666; margin-left: 35px;">Chill cùng nhau dưới ánh đèn! <span class="cute-emoji">🌙</span></p>
            </div>
            
            <button class="submit-btn" id="submitBtn" disabled>
                Gửi lựa chọn của em pé <span class="cute-emoji">💌</span>
            </button>

            <div class="success-message" id="successMessage">
                <span class="cute-emoji">🎉</span> Email đã tự động gửi từ hytaty@gmail.com đến huynhtranty@gmail.com thành công! <span class="cute-emoji">💕</span>
                <div style="font-size: 12px; margin-top: 10px; opacity: 0.8;">
                    📧 Kiểm tra hộp thư đến của huynhtranty@gmail.com nhé!
                </div>
            </div>

            <!-- Interactive Quiz Section -->
            <div class="quiz-section" id="quizSection">
                <h3>🎯 Câu hỏi vui: Em có muốn đi chơi không? 💕</h3>
                <div class="quiz-option" data-answer="correct">
                    ✨ Có chứ! Đi liền! 😍
                </div>
                <div class="quiz-option" data-answer="correct">
                    💖 Tất nhiên rồi! Em đang mong chờ lắm!
                </div>
                <div class="quiz-option" data-answer="correct">
                    🌟 Chắc chắn luôn! Let's go! 🚀
                </div>
                <div class="quiz-option" data-answer="wrong">
                    😢 Hôônổng dđi...
                </div>
            </div>

            <!-- Yes/No Buttons -->
            <div class="schedule-item" style="margin-top: 25px; text-align: center;">
                <h3 style="justify-content: center;">💝 Em có muốn đi xem phim với anh không?</h3>
                <div class="button-container">
                    <button class="accept-btn" id="acceptBtn">
                        Có! Em muốn lắm! 💕
                    </button>
                    <button class="reject-btn" id="rejectBtn">
                        Hôônổng dđi 😢
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Notification function to replace alert()
        function showNotification(message) {
            // Create overlay
            const overlay = document.createElement('div');
            overlay.className = 'notification-overlay';

            // Create notification box
            const notificationBox = document.createElement('div');
            notificationBox.className = 'notification-box';
            notificationBox.innerHTML = `
                <div class="notification-box-content">${message}</div>
                <button class="notification-box-btn">OK</button>
            `;

            // Add to DOM
            document.body.appendChild(overlay);
            document.body.appendChild(notificationBox);

            // Show with animation
            setTimeout(() => {
                overlay.classList.add('show');
                notificationBox.classList.add('show');
            }, 10);

            // Close notification on button click
            const closeBtn = notificationBox.querySelector('.notification-box-btn');
            closeBtn.addEventListener('click', () => {
                overlay.classList.remove('show');
                notificationBox.classList.remove('show');

                setTimeout(() => {
                    overlay.remove();
                    notificationBox.remove();
                }, 300);
            });

            // Close on overlay click
            overlay.addEventListener('click', () => {
                closeBtn.click();
            });
        }

        let selectedMovie = null;
        let isPlaying = false;
        const music = document.getElementById('backgroundMusic');
        const musicBtn = document.getElementById('musicBtn');
        
        // Dragging variables
        let isDragging = false;
        let dragOffset = { x: 0, y: 0 };
        const musicControls = document.querySelector('.music-controls');
        
        // Make music controls draggable
        function initDragging() {
            let dragStartTime = 0;
            let hasMoved = false;
            let dragThreshold = 5; // pixels
            let startPos = { x: 0, y: 0 };
            
            // Mouse events
            musicControls.addEventListener('mousedown', startDrag);
            document.addEventListener('mousemove', drag);
            document.addEventListener('mouseup', endDrag);
            
            // Touch events
            musicControls.addEventListener('touchstart', startDragTouch, { passive: false });
            document.addEventListener('touchmove', dragTouch, { passive: false });
            document.addEventListener('touchend', endDrag);
            
            function startDrag(e) {
                // Don't start drag if clicking on the music button itself
                if (e.target.closest('.music-btn')) {
                    return;
                }
                
                dragStartTime = Date.now();
                hasMoved = false;
                startPos.x = e.clientX;
                startPos.y = e.clientY;
                
                const rect = musicControls.getBoundingClientRect();
                dragOffset.x = e.clientX - rect.left;
                dragOffset.y = e.clientY - rect.top;
            }
            
            function startDragTouch(e) {
                if (e.touches.length === 1) {
                    const touch = e.touches[0];
                    
                    // Don't start drag if touching the music button itself
                    if (e.target.closest('.music-btn')) {
                        return;
                    }
                    
                    dragStartTime = Date.now();
                    hasMoved = false;
                    startPos.x = touch.clientX;
                    startPos.y = touch.clientY;
                    
                    const rect = musicControls.getBoundingClientRect();
                    dragOffset.x = touch.clientX - rect.left;
                    dragOffset.y = touch.clientY - rect.top;
                }
            }
            
            function drag(e) {
                if (dragStartTime === 0) return;
                
                const currentX = e.clientX;
                const currentY = e.clientY;
                const distance = Math.sqrt(
                    Math.pow(currentX - startPos.x, 2) + Math.pow(currentY - startPos.y, 2)
                );
                
                if (distance > dragThreshold && !isDragging) {
                    isDragging = true;
                    hasMoved = true;
                    musicControls.classList.add('dragging');
                }
                
                if (isDragging) {
                    moveElement(currentX, currentY);
                    e.preventDefault();
                }
            }
            
            function dragTouch(e) {
                if (dragStartTime === 0 || e.touches.length !== 1) return;
                
                const touch = e.touches[0];
                const currentX = touch.clientX;
                const currentY = touch.clientY;
                const distance = Math.sqrt(
                    Math.pow(currentX - startPos.x, 2) + Math.pow(currentY - startPos.y, 2)
                );
                
                if (distance > dragThreshold && !isDragging) {
                    isDragging = true;
                    hasMoved = true;
                    musicControls.classList.add('dragging');
                }
                
                if (isDragging) {
                    moveElement(currentX, currentY);
                    e.preventDefault();
                }
            }
            
            function moveElement(clientX, clientY) {
                const windowWidth = window.innerWidth;
                const windowHeight = window.innerHeight;
                const elementWidth = musicControls.offsetWidth;
                const elementHeight = musicControls.offsetHeight;
                
                // Calculate new position
                let newX = clientX - dragOffset.x;
                let newY = clientY - dragOffset.y;
                
                // Boundary checking
                newX = Math.max(0, Math.min(newX, windowWidth - elementWidth));
                newY = Math.max(0, Math.min(newY, windowHeight - elementHeight));
                
                // Apply position
                musicControls.style.left = newX + 'px';
                musicControls.style.top = newY + 'px';
                musicControls.style.right = 'auto';
                musicControls.style.bottom = 'auto';
            }
            
            function endDrag(e) {
                if (isDragging) {
                    isDragging = false;
                    musicControls.classList.remove('dragging');
                    
                    // Prevent click event if we actually dragged
                    if (hasMoved) {
                        e.preventDefault();
                        e.stopPropagation();
                    }
                }
                
                dragStartTime = 0;
                hasMoved = false;
            }
        }
        
        // Initialize dragging when page loads
        document.addEventListener('DOMContentLoaded', function() {
            initDragging();
            
            // Initialize music control after DOM is loaded
            initMusicControl();
        });
        
        // Music control
        function initMusicControl() {
            musicBtn.addEventListener('click', function(e) {
                // Prevent event bubbling to parent elements
                e.stopPropagation();
                
                // Only handle click if we're not in the middle of dragging
                if (isDragging) {
                    return;
                }
            if (isPlaying) {
                music.pause();
                musicBtn.innerHTML = '🎵';
                musicBtn.classList.remove('playing');
                document.querySelector('.music-info div:last-child').textContent = 'Click để phát nhạc';
                isPlaying = false;
            } else {
                music.play().then(() => {
                    musicBtn.innerHTML = '🎶';
                    musicBtn.classList.add('playing');
                    document.querySelector('.music-info div:last-child').textContent = 'Đang phát...';
                    isPlaying = true;
                }).catch(error => {
                    console.log('Cannot play audio:', error);
                    // Fallback to romantic ambiance
                    playRomanticAmbiance();
                    musicBtn.innerHTML = '🎶';
                    musicBtn.classList.add('playing');
                    document.querySelector('.music-info div:last-child').textContent = 'Đang phát...';
                    isPlaying = true;
                });
            }
        });
        }
        
        function playRomanticAmbiance() {
            // Gentle romantic melody as fallback if file doesn't load
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                
                function playNote(frequency, startTime, duration) {
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    oscillator.frequency.setValueAtTime(frequency, startTime);
                    oscillator.type = 'sine';
                    
                    gainNode.gain.setValueAtTime(0, startTime);
                    gainNode.gain.linearRampToValueAtTime(0.05, startTime + 0.1);
                    gainNode.gain.linearRampToValueAtTime(0, startTime + duration);
                    
                    oscillator.start(startTime);
                    oscillator.stop(startTime + duration);
                }
                
                const melody = [523.25, 587.33, 659.25, 698.46, 783.99];
                let time = audioContext.currentTime;
                
                function playMelody() {
                    if (isPlaying) {
                        melody.forEach((note, index) => {
                            playNote(note, time + index * 0.8, 1.2);
                        });
                        time += 4;
                        setTimeout(playMelody, 4000);
                    }
                }
                
                playMelody();
            } catch (error) {
                console.log('Audio context not supported');
            }
        }
        
        // Handle movie selection
        document.querySelectorAll('.movie-card').forEach(card => {
            card.addEventListener('click', function() {
                document.querySelectorAll('.movie-card').forEach(c => c.classList.remove('selected'));
                this.classList.add('selected');
                selectedMovie = this.dataset.movie;
                document.getElementById('submitBtn').disabled = false;
            });
        });

        // Quiz interaction
        document.querySelectorAll('.quiz-option').forEach(option => {
            option.addEventListener('click', function() {
                const isCorrect = this.dataset.answer === 'correct';

                // Remove previous states
                document.querySelectorAll('.quiz-option').forEach(opt => {
                    opt.classList.remove('correct', 'wrong');
                    opt.style.pointerEvents = 'auto';
                });

                if (isCorrect) {
                    this.classList.add('correct');
                    setTimeout(() => {
                        showNotification('Đúng rồi! Em giỏi quá! 🎉💕');
                    }, 300);
                } else {
                    this.classList.add('wrong');
                    setTimeout(() => {
                        showNotification('Ơ kìa! Chọn lại đi em! 😄💖');
                        this.classList.remove('wrong');
                    }, 500);
                }
            });
        });

        // Runaway button logic with improved flow
        let rejectBtn = null;
        let acceptBtn = null;
        let escapeCount = 0;
        const maxEscapes = 5; // Giảm số lần chạy trốn để flow mượt hơn
        let hasEscaped = false;

        // Initialize buttons after DOM is ready
        function initButtons() {
            rejectBtn = document.getElementById('rejectBtn');
            acceptBtn = document.getElementById('acceptBtn');

            console.log('Reject button:', rejectBtn);
            console.log('Accept button:', acceptBtn);

            if (rejectBtn && acceptBtn) {
                // No need to init position, button stays in normal flow until first escape
                setupEventListeners();
            }
        }

        // Messages hiển thị khi nút chạy trốn
        const escapeMessages = [
            'Đừng mà! 😢',
            'Không được đâu! 🥺',
            'Em nghĩ lại đi! 💔',
            'Đừng chọn "Không" mà! 😭',
            'Anh buồn lắm! 💔'
        ];

        function getRandomPosition() {
            if (!rejectBtn) return { x: 100, y: 100 };

            const btnRect = rejectBtn.getBoundingClientRect();

            // For position:fixed, use viewport coordinates (no scroll offset needed)
            const viewportWidth = window.innerWidth;
            const viewportHeight = window.innerHeight;

            // Safe margins
            const margin = 50;
            const minX = margin;
            const maxX = viewportWidth - btnRect.width - margin;
            const minY = margin;
            const maxY = viewportHeight - btnRect.height - margin;

            // Ensure we have valid range
            if (maxX <= minX || maxY <= minY) {
                console.log('Invalid range, using center');
                return {
                    x: viewportWidth / 2 - btnRect.width / 2,
                    y: viewportHeight / 2 - btnRect.height / 2
                };
            }

            // Generate new position away from current button position
            let x, y;
            let attempts = 0;
            do {
                x = Math.random() * (maxX - minX) + minX;
                y = Math.random() * (maxY - minY) + minY;
                attempts++;

                // Make sure new position is at least 150px away from current position
                const distance = Math.sqrt(Math.pow(x - btnRect.left, 2) + Math.pow(y - btnRect.top, 2));
                if (distance >= 150) break;
            } while (attempts < 20);

            console.log('New position:', {
                x,
                y,
                currentPos: { left: btnRect.left, top: btnRect.top },
                viewport: { width: viewportWidth, height: viewportHeight }
            });

            return { x, y };
        }

        function escapeFromCursor(e) {
            if (!rejectBtn || hasEscaped) return;

            const btnRect = rejectBtn.getBoundingClientRect();
            const btnCenterX = btnRect.left + btnRect.width / 2;
            const btnCenterY = btnRect.top + btnRect.height / 2;

            const mouseX = e.clientX;
            const mouseY = e.clientY;

            const distance = Math.sqrt(
                Math.pow(mouseX - btnCenterX, 2) +
                Math.pow(mouseY - btnCenterY, 2)
            );

            // Trigger escape when cursor is within 120px
            if (distance < 120 && escapeCount < maxEscapes) {
                hasEscaped = true;

                // Convert to fixed position on first escape
                if (escapeCount === 0) {
                    makeButtonFixed();
                }

                // Thay đổi text của nút
                if (escapeCount < escapeMessages.length) {
                    rejectBtn.innerHTML = escapeMessages[escapeCount];
                }

                // Di chuyển nút đến vị trí mới
                const pos = getRandomPosition();

                // Double check position is valid
                const finalX = Math.max(20, Math.min(pos.x, window.innerWidth - 200));
                const finalY = Math.max(20, Math.min(pos.y, window.innerHeight - 100));

                rejectBtn.style.left = finalX + 'px';
                rejectBtn.style.top = finalY + 'px';

                console.log('Button moved to:', { x: finalX, y: finalY });

                escapeCount++;

                // Shrink the button gradually
                const newScale = 1 - (escapeCount * 0.15);
                rejectBtn.style.transform = `scale(${Math.max(newScale, 0.3)})`;

                // Cho phép escape lại sau 500ms
                setTimeout(() => {
                    hasEscaped = false;
                }, 500);

                // Khi đã chạy trốn đủ số lần
                if (escapeCount >= maxEscapes) {
                    setTimeout(() => {
                        // Hiệu ứng rung lắc
                        rejectBtn.style.animation = 'shake 0.5s';
                        rejectBtn.innerHTML = 'Thôi được rồi! 😌';

                        setTimeout(() => {
                            // Biến nút "Không" thành nút "Có"
                            rejectBtn.style.transition = 'all 0.5s ease';
                            rejectBtn.style.transform = 'scale(1.2)';
                            rejectBtn.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
                            rejectBtn.innerHTML = 'Được rồi, em đi! 💕';
                            rejectBtn.classList.remove('reject-btn');
                            rejectBtn.classList.add('accept-btn');

                            // Khi click vào nút đã biến đổi
                            rejectBtn.onclick = function() {
                                showNotification('Haha! Cuối cùng em cũng đồng ý rồi! 🎉💕');
                                setTimeout(() => {
                                    rejectBtn.style.transform = 'scale(0)';
                                    setTimeout(() => {
                                        rejectBtn.remove();
                                        acceptBtn.style.transform = 'scale(1.1)';
                                        setTimeout(() => {
                                            acceptBtn.style.transform = 'scale(1)';
                                        }, 300);
                                    }, 500);
                                }, 1000);
                            };
                        }, 1000);
                    }, 300);
                }
            }
        }

        // Convert button to fixed position when it starts escaping
        function makeButtonFixed() {
            if (!rejectBtn) return;

            const rect = rejectBtn.getBoundingClientRect();

            // Move button to body to escape parent overflow/z-index issues
            document.body.appendChild(rejectBtn);

            rejectBtn.style.position = 'fixed';
            rejectBtn.style.left = rect.left + 'px';
            rejectBtn.style.top = rect.top + 'px';
            rejectBtn.style.margin = '0';
            rejectBtn.style.zIndex = '10000'; // Very high z-index to be on top

            console.log('Button converted to fixed at:', {
                left: rect.left,
                top: rect.top
            });
        }

        // Setup event listeners
        function setupEventListeners() {
            // Track mouse movement
            document.addEventListener('mousemove', escapeFromCursor);

            // Touch support for mobile
            document.addEventListener('touchmove', function(e) {
                const touch = e.touches[0];
                escapeFromCursor({
                    clientX: touch.clientX,
                    clientY: touch.clientY
                });
            });


            // Accept button action
            acceptBtn.addEventListener('click', function() {
                const messages = [
                    'Yay! Em đồng ý rồi! 🎉💕',
                    'Anh biết mà! Em yêu anh nhất! 😘💖',
                    'Tuyệt vời! Hẹn gặp em nhé! 🌟💝',
                    'Em là người tuyệt vời nhất! 💕✨'
                ];
                const randomMessage = messages[Math.floor(Math.random() * messages.length)];

                // Celebration effect
                this.innerHTML = '🎊 Yay! 🎊';
                setTimeout(() => {
                    showNotification(randomMessage);
                    this.innerHTML = 'Có! Em muốn lắm! 💕';
                }, 500);
            });
        }

        // Initialize everything when DOM is loaded
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initButtons);
        } else {
            initButtons();
        }
        
        // Handle form submission with Web3Forms
        document.getElementById('submitBtn').addEventListener('click', async function() {
            if (!selectedMovie) return;
            
            // Disable button and show loading
            this.disabled = true;
            this.innerHTML = 'Đang gửi... <span class="cute-emoji">⏳</span>';
            
            const emailData = {
                access_key: "1097c6ec-aaff-43da-bfb2-9cc6cce5979b", // Thay bằng key mới từ web3forms.com
                subject: "Em pé đã chọn phim rồi! 🎬💕",
                from_name: "Dân chơi aka em pé aka bé nhỏ aka tv",
                from_email: "hytaty2109@gmail.com",
                to_email: "huynhtranty@gmail.com",
                message: `Cảm ơn Vy nhìuuuu! 💕

Kafea của T đã chọn phim rồi nhé:

🎬 Phim đã chọn: ${selectedMovie}

Hẹn gặp T đúng giờ nha! 

---
Gửi từ website cute của Ty làm 😘`
            };
            
            try {
                console.log('Đang gửi email...', emailData);
                
                const response = await fetch('https://api.web3forms.com/submit', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify(emailData)
                });
                
                console.log('Response status:', response.status);
                const result = await response.json();
                console.log('Response result:', result);
                
                if (result.success) {
                    document.getElementById('successMessage').style.display = 'block';
                    this.innerHTML = 'Đã gửi thành công! <span class="cute-emoji">✨</span>';
                } else {
                    console.error('Web3Forms error:', result.message);
                    throw new Error(`Web3Forms failed: ${result.message || 'Unknown error'}`);
                }
            } catch (error) {
                console.error('Email sending failed:', error);
                showNotification(`Lỗi gửi email: ${error.message}. Sẽ chuyển sang mailto...`);

                // Fallback to mailto if auto-send fails
                const subject = encodeURIComponent('Em pé đã chọn phim rồi! 🎬💕');
                const body = encodeURIComponent(emailData.message);
                const mailtoLink = `mailto:huynhtranty@gmail.com?subject=${subject}&body=${body}`;
                window.location.href = mailtoLink;

                this.innerHTML = 'Mở email để gửi <span class="cute-emoji">📧</span>';
                this.disabled = false;
            }
        });
    </script>
</body>
</html>
